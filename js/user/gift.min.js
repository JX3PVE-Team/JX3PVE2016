jQuery(function(t){function i(i){var e=~~i.find(".u-credit-rq").text(),n=~~i.find(".u-credit-sj").text();t("#u-credit-rq").val(c-e),t("#u-credit-sj").val(l-n),f(),t("ul.rights").find("li").eq(4).html("<em>人气: </em>"+c),t("ul.rights").find("li").eq(5).html("<em>水晶: </em>"+l)}var e=function(t,i){for(var e=/<%([^%>]+)?%>/g,n=/(^( )?(if|for|else|switch|case|break|{|}))(.*)?/g,r="var r=[];\n",a=0,s=function(t,i){return r+=i?t.match(n)?t+"\n":"r.push("+t+");\n":""!=t?'r.push("'+t.replace(/"/g,'\\"')+'");\n':"",s};match=e.exec(t);)s(t.slice(a,match.index))(match[1],!0),a=match.index+match[0].length;return s(t.substr(a,t.length-a)),r+='return r.join("");',new Function(r.replace(/[\r\t\n]/g,"")).apply(i)},n=function(){t(".exchange").click(function(){var e=t(this).parent(),n=~~e.find(".u-gift-num").text();if(1>n)return alert("礼品兑换数量不足,请选择其他礼品!");if(!r(t(this).parent()))return alert("水晶不足! 请好好努力哟!");var s=t(this).data("id");t.get("/api/gift/?do=buy&gift_id="+s).success(function(t){t=JSON.parse(t),0==t.code?(alert("申请兑换成功! 请等待审核."),u(),a(),i(e)):alert(t.msg)}).fail(function(){alert("兑换失败! \n Error Code: lt-ajax-buy")})})},r=function(t){var i=~~t.find(".u-credit-rq").text(),e=~~t.find(".u-credit-sj").text();return c>=i&&l>=e?!0:!1},a=function(){t.get("/api/gift/?do=list",function(i){if(i=JSON.parse(i),0!=i.code)return alert(i.msg);for(var r=t("#giftListTempl").html(),a=i.data,s=[],u=0,c=a.length;c>u;u++)s.push(e(r,a[u]));t("#m-gift-list").html(s.join("")),n(),o()})};a();var s=function(t){var i={"-1":"isfalse",0:"ispending",1:"istrue"},e={"-1":"驳回",0:"待审核",1:"成功"},n={},r=[];for(var a in t.cost)r.push(t.cost[a]+a);return n.name=t.name,n.date=t.date,n.clazz=i[""+t.status],n.status=e[""+t.status],n.desc=r.join(","),n},u=function(){t.get("/api/gift/?do=history",function(i){if(i=JSON.parse(i),0!=i.code)return alert(i.msg);for(var n=i.data,r=[],a=t("#giftRecordsTempl").html(),u=0,c=n.length;c>u;u++)r.push(e(a,s(n[u])));t("#m-gift-record-tbody").html(r.join(""))})};u(),t(".baseinfo a").on("click",function(){t(".baseinfo a").removeClass("on"),t(this).addClass("on");var i=t(this).index();t(".m-gift-block").hide().eq(i).show()});var c=0,l=0,f=function(){c=~~t("#u-credit-rq").val(),l=~~t("#u-credit-sj").val()};f();var o=function(){t(".u-credit-rq").each(function(){var i=parseInt(t(this).text());t(this).addClass(i>c?"isfalse":"istrue")}),t(".u-credit-sj").each(function(){var i=parseInt(t(this).text());t(this).addClass(i>l?"isfalse":"istrue")}),t(".u-gift-num").each(function(){var i=parseInt(t(this).text());i||t(this).parent(".u-num").addClass("isnull").next(".u-go").addClass("isnull")}),t(".u-go").each(function(){t(this).hasClass("isnull")&&t(this).on("click",function(t){t.preventDefault()})})}});
var tSource='<li class="app-servers-list-item app-servers-list-header">\n    <span class="daqu">大区</span>\n    <span class="fwq">服务器</span>\n    <span class="status">状态</span>\n    <span class="recent">最近开服记录</span>\n    <span class="history">上一次记录</span>\n    <span class="top">置顶</span>\n    <span class="fav">收藏</span>\n    <span class="feed">订阅</span>\n</li>\n<!--第一条被置顶的条目添加.app-servers-list-item-top-->\n<!--被收藏的条目添加.app-servers-list-item-fav，并且行内输出自定义的背景色-->\n<!--没有被收藏和置顶的才添加app-servers-list-item-normal，一旦添加了则移除这个类名-->\n<!--畅通状态1添加status-1-->\n<!--爆满状态2添加status-2-->\n<!--维护状态3添加status-3-->\n\n{{each serverList as server index}} \n  <li class="app-servers-list-item\n      {{if server.isTop}}app-servers-list-item-top{{/if}}\n      {{if server.isCollect}}app-servers-list-item-fav{{/if}}\n      {{server | getNormalClass}}\n      " \n      {{if isShowBGC(server)}}style="background-color:{{server.backgroundcolor}}"{{/if}}>\n      <span class="daqu">{{server.area}}</span>\n      <span class="fwq">{{server.name}}</span>\n      <span class="status status-{{server.status}}">{{server.status | getStatusText}}</span>\n      <span class="recent">{{server.latest}}<em>（{{server.latest | getXQDay}}）</em></span>\n      <span class="history">{{server.history}}<em>（{{server.history | getXQDay}}）</em></span>\n      <!--当点击置顶后，给i添加.istop，并将title修改为"取消置顶"-->\n      <span class="top" data-id="{{server.id}}" data-top="{{server.isTop}}"><i class="u-icon-top {{if server.isTop}}istop{{/if}}" title="{{server.isTop | getTopText}}">置顶</i></span>\n      <span class="fav" data-id="{{server.id}}" data-collect="{{server.isCollect}}"><i class="u-icon-fav {{if server.isCollect}}isfav{{/if}}"  title="{{server.isCollect | getCollectText}}">收藏</i></span>\n      <span class="feed" data-id="{{server.id}}" data-feed="{{server.isFeed}}"><i class="u-icon-feed" title="暂未开放">订阅</i></span>\n  </li>\n{{/each}}',allData=[],doSort=function(e){for(var t=[],a=[],s=0;s<e.length;s++){var r=e[s];r.isTop?t.push(r):a.push(r)}return t.concat(a)},doSearch=function(e){if(!e)return allData;for(var t=[],a=0;a<allData.length;a++){var s=allData[a];(-1!=s.area.indexOf(e)||-1!=s.name.indexOf(e))&&t.push(s)}return t},getServerList=function(e,t,a){return allData.length&&!a?t&&t({serverList:doSearch(e)}):void jQuery.get("/api/server/list.php",function(e){return e=JSON.parse(e),allData=doSort(e),t&&t({serverList:allData})})},letServerTop=function(e,t,a){jQuery.get("/api/server/action.php",{"do":"top",serverid:e,value:t+""=="1"?0:1},function(e){a(JSON.parse(e))})},letServerFeed=function(e,t,a){},letServerFav=function(e,t,a,s){s||(s="#0084ff"),jQuery.get("/api/server/action.php",{"do":"collect",serverid:e,backgroundcolor:s,value:t},function(e){a(JSON.parse(e))})};jQuery(function(e){{var t=window.template,a=(e("#userUID").val(),e("#userGroupId").val()),s=function(t){return 0===t?(e(".app-dialog").hide(),void n(!0)):(e(".app-dialog").show(),e(".app-dialog").find(".app-dialog-tips").hide(),void e(".app-dialog").find("#action_error_"+t).show())};e("#background-color-input").colorPicker({customBG:"#ff99cc",readOnly:!1,init:function(e,t){e.style.backgroundColor=e.value,e.style.color=t.rgbaMixCustom.luminance>.22?"#222":"#ddd"}})}e(".app-dialog .app-dialog-fav-ui").find(".u-btn-go").click(function(){var t=e(this).data("id"),a=e(this).data("isCollect")+""=="1"?0:1;letServerFav(t,a,function(e){s(e.code)},e("#background-color-input").val())}),e(".app-dialog .m-title .close").click(function(){e(".app-dialog").hide()}),t.helper("getNormalClass",function(e){return e.isTop||e.isCollect?void 0:"app-servers-list-item-normal"}),t.helper("getTopText",function(e){return e?"取消置顶":"置顶"}),t.helper("getStatusText",function(e){return["畅通","爆满","维护"][e-1]||"未知"}),t.helper("getXQDay",function(e){e=e.replace(/^\s/,"");var t=parseInt(e.substr(0,4)),a=parseInt(e.substr(5,2)),s=parseInt(e.substr(8,2)),r=new Date(t,a-1,s),i=r.getDay(),n="本",l=new Date,o=l.getFullYear(),p=l.getMonth(),c=l.getDate()-l.getDay(),d=new Date(o,p,c);return r.getTime()<d.getTime()&&(n="上"),n+["周天","周一","周二","周三","周四","周五","周六"][i]}),t.helper("getCollectText",function(e){return e?"取消收藏":"收藏"}),t.helper("isShowBGC",function(e){return e.isCollect&&e.backgroundcolor});var r=t.compile(tSource),i=function(){e("#app-servers-list").find(".app-servers-list-item .top").click(function(){return""+a=="7"?void s(1):void letServerTop(e(this).data("id"),e(this).data("top"),function(e){s(e.code)})}),e("#app-servers-list").find(".app-servers-list-item .fav").click(function(){if(""+a=="7")return void s(1);var t=e(this).data("id"),r=e(this).data("collect")+""=="1"?0:1;return 0===r?void letServerFav(t,r,function(e){s(e.code)}):(e(".app-dialog").show(),e(".app-dialog").find(".app-dialog-tips").hide(),e(".app-dialog").find(".app-dialog-fav-ui").show(),void e(".app-dialog .app-dialog-fav-ui").find(".u-btn-go").data("id",e(this).data("id")).data("isCollect",e(this).data("collect")))}),e("#app-servers-list").find(".app-servers-list-item .feed").click(function(){letServerFeed(e(this).data("id"),e(this).data("feed"),function(e){s(e.code)})})},n=function(t){var a=document.getElementById("search_txt").value;a=a.replace(/\s/g,""),getServerList(a,function(t){e("#app-servers-list").html(r(t)),i()},t)};e("#search_btn").click(function(){n(!1)}),e("#search_txt").keyup(function(e){13===e.keyCode&&(e.preventDefault(),n(!1))}),n(!0)});
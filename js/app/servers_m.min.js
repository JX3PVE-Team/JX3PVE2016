jQuery(function(e){var t=(e("#userUID").val(),e("#userGroupId").val()),n='{{each serverList as server index}}\n<div class="m-result">\n   <div class="m-info">\n       {{server.area}} > {{server.name}}\n       <span class="status status-{{server.status}}">\n           {{server.status | getStatusText}}\n       </span>\n   </div>\n   <div class="m-info">\n       最新开服记录\n       <span class="recent">\n           {{server.latest}}<em>（{{server.latest | getXQDay}}）</em>\n       </span>\n   </div>\n   <div class="m-info">\n       上一次记录\n       <span class="history">\n           {{server.history}}<em>（{{server.history | getXQDay}}）</em>\n       </span>\n   </div>\n   <div class="m-panel">\n       <ul>\n         <!-- 已结操作后同时还要给li添加.has -->\n         <li class="top" data-id="{{server.id}}" data-top="{{server.isTop}}"><i class="u-icon-top {{if server.isTop}}istop{{/if}}"></i><b>{{server.isTop | getTopText}}</b></li>\n         <li class="fav" data-id="{{server.id}}" data-collect="{{server.isCollect}}"><i class="u-icon-fav {{if server.isCollect}}isfav{{/if}}"></i><b>{{server.isCollect | getCollectText}}</b></li>\n         <!-- <li class="feed" data-id="{{server.id}}" data-top="{{server.isFeed}}"><i class="u-icon-feed"></i><b>订阅</b></li> -->\n       </ul>\n   </div>\n</div>\n{{/each}}',s=template.compile(n);template.helper("getTopText",function(e){return e?"取消置顶":"置顶"}),template.helper("getStatusText",function(e){return["畅通","爆满","维护"][e-1]||"未知"}),template.helper("getXQDay",function(e){e=e.replace(/^\s/,"");var t=parseInt(e.substr(0,4)),n=parseInt(e.substr(5,2)),s=parseInt(e.substr(8,2)),r=new Date(t,n-1,s),i=r.getDay(),a="本",o=new Date,l=o.getFullYear(),c=o.getMonth(),u=o.getDate()-o.getDay(),v=new Date(l,c,u);return r.getTime()<v.getTime()&&(a="上"),a+["周天","周一","周二","周三","周四","周五","周六"][i]}),template.helper("getCollectText",function(e){return e?"取消收藏":"收藏"});var r=function(e){for(var t=[],n=[],s=0;s<e.length;s++){var r=e[s];r.isTop?t.push(r):n.push(r)}return t.concat(n)},i=function(e){for(var t={},n=0;n<e.length;n++){var s=e[n];t[s.area]?t[s.area].push(s):t[s.area]=[s]}return t},a=function(){for(var e=[],t=0;t<c.length;t++){var n=c[t];(n.isTop||n.isCollect)&&e.push(n)}return e},o=function(e){if(!e)return c;for(var t=[],n=0;n<c.length;n++){var s=c[n];(-1!=s.area.indexOf(e)||-1!=s.name.indexOf(e))&&t.push(s)}return t},l=function(e){for(var t=0;t<c.length;t++){var n=c[t];if(n.id+""==e+"")return[n]}return[]},c=[],u={},v=function(e,t,n){return c.length&&!n?t&&t({serverList:o(e)}):void jQuery.get("/api/server/list.php",function(e){return e=JSON.parse(e),c=r(e),u=i(c),t&&t({serverList:c})})},d=function(){var e=[],t=null;for(x in u)t||(t=x),e.push("<option value='"+x+"'>"+x+"</option>");document.getElementById("chooseArea").innerHTML=e.join(""),h(t)},h=function(e){for(var t=u[e],n=[],s=0;s<t.length;s++)n.push("<option value='"+t[s].id+"'>"+t[s].name+"</option>");document.getElementById("chooseServer").innerHTML=n.join("")},p=function(e,t,n){jQuery.get("/api/server/action.php",{"do":"top",serverid:e,value:t+""=="1"?0:1},n)},f=function(e,t,n){jQuery.get("/api/server/action.php",{"do":"collect",serverid:e,backgroundcolor:"#ff99cc",value:t+""=="1"?0:1},n)};e("#chooseArea").change(function(){h(e(this).val())}),e("#searchLink").click(function(){var t=null;t=e("#search_txt").val()?o(e("#search_txt").val()):l(e("#chooseServer").val()),w({serverList:t})}),e("#backSearch").click(function(){e("#showDetailsResult").slideUp(),e("#chooseAndSearchContent").slideDown(),e("#top-back").hide()}),e("#backSearchResult").click(function(){e("#showActionResult").slideUp(),e("#showDetailsResult").slideDown()}),e("#top-back").click(function(){e("#showDetailsResult").slideUp(),e("#chooseAndSearchContent").slideDown(),e("#top-back").hide()});var g=function(t){e("#showDetailsResult").slideUp(),e("#showActionResult").slideDown(),e("#showActionResult").find(".app-dialog-tips").hide(),e("#action_error_"+t).show()},m=function(t){t=JSON.parse(t);var n=t.code;return 0!=n?void g(n):void v(null,function(){var t=null;t=e("#search_txt").val()?o(e("#search_txt").val()):l(e("#chooseServer").val()),w({serverList:t})},!0)},D=function(){e("#searchResult").find(".top").click(function(){return""+t=="7"?void g(1):void p(e(this).data("id"),e(this).data("top"),m)}),e("#searchResult").find(".fav").click(function(){return""+t=="7"?void g(1):void f(e(this).data("id"),e(this).data("collect"),m)}),e("#searchResult").find(".feed").click(function(){letServerFeed(e(this).data("id"),e(this).data("feed"),m)})},w=function(t){e("#searchResult").html(s(t)),t.serverList.length>3&&e("#top-back").show(),e("#chooseAndSearchContent").slideUp(),e("#showDetailsResult").slideDown(),D()};v("",d,!0),e(".app-footer .item-2").click(function(){return""+t=="7"?void g(1):void w({serverList:a()})})});